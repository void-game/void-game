import{TileName as h}from"@core";import{l as g,a as y}from"./vendor.4afd3897.js";const v=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const c of e.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?e.credentials="include":t.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(t){if(t.ep)return;t.ep=!0;const e=o(t);fetch(t.href,e)}};v();const d=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],f={[h.DIRT]:{color:"#A0522D"},[h.GRASS]:{color:"#006400"}},u={tile:f[h.DIRT]},x=(n=u)=>{const{tile:i=u.tile}=n,o={};for(let r=0;r<16;r++)for(let t=0;t<24;t++)r%2==0&&t%2!=0||r%2!=0&&t%2==0?o[`${d[r]}${t}`]={tile:i,position:{x:t,y:r}}:o[`${d[r]}${t}`]={tile:f[h.GRASS],position:{x:t,y:r}};return o},p=x({});class S{constructor(){var t;this.height=864,this.width=1296,this.draw=(e,c)=>{this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawFPS(c),Object.keys(p).forEach(l=>{this.renderCell(p[l])}),e.forEach(l=>{this.renderEntity(l)})},this.renderCell=e=>{this.context.fillStyle=e.tile.color,this.context.fillRect(e.position.x*(this.width/24),e.position.y*(this.height/16),54*this.ratio,54*this.ratio)},this.renderEntity=e=>{this.context.fillStyle=e.state.color,this.context.fillRect(e.state.position.x,e.state.position.y,54*this.ratio,54*this.ratio),this.context.font="20px Arial",this.context.fillStyle="white",this.context.textAlign="center",this.context.fillText(e.state.name,e.state.position.x+27,e.state.position.y-5)},this.drawFPS=e=>{this.context.font="25px Arial",this.context.fillStyle="yellow",this.context.fillText("FPS: "+e,10,30)},this.resize=()=>{this.canvas.height=this.height,this.canvas.width=this.width,this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px"},this.generateCanvas=()=>{const e=document.createElement("canvas"),c=e.getContext("2d");if(!c)throw new Error("no context");return e.height=this.height,e.width=this.width,e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",e.style.backgroundColor="black",{canvas:e,context:c}};const i=document.getElementById("root");if(!i)throw new Error("no root");this.root=i;const{canvas:o,context:r}=this.generateCanvas();this.canvas=o,this.context=r,this.ratio=1,this.canvas.style.border="5px solid var(--gameboy-grey)",this.canvas.style.boxSizing="border-box",(t=this.root)==null||t.append(this.canvas),window.addEventListener("resize",this.resize)}}var s;(function(n){n.RIGHT="right",n.LEFT="left",n.DOWN="down",n.UP="up",n.SPRINT="sprint"})(s||(s={}));const w={68:s.RIGHT,65:s.LEFT,83:s.DOWN,87:s.UP,38:s.UP,37:s.LEFT,39:s.RIGHT,40:s.DOWN,16:s.SPRINT},a={[s.RIGHT]:!1,[s.LEFT]:!1,[s.UP]:!1,[s.DOWN]:!1},T=n=>{document.onkeydown=i=>{const o=w[i.keyCode];if(o)switch(o){case s.RIGHT:a[s.RIGHT]=!0;break;case s.LEFT:a[s.LEFT]=!0;break;case s.DOWN:a[s.DOWN]=!0;break;case s.UP:a[s.UP]=!0;break;case s.SPRINT:a[s.SPRINT]=!0;break}n.server.emit("keyDown",{isPressed:a})},document.onkeyup=i=>{const o=w[i.keyCode];if(o)switch(o){case s.RIGHT:a[s.RIGHT]=!1;break;case s.LEFT:a[s.LEFT]=!1;break;case s.DOWN:a[s.DOWN]=!1;break;case s.UP:a[s.UP]=!1;break;case s.SPRINT:a[s.SPRINT]=!1;break}n.server.emit("keyDown",{isPressed:a})}};class P{constructor(i){this._server=g("http://localhost:8080"),this._entities=[],this._server.on("connect",()=>{console.log("connected"),this._server.emit("join",i)})}get server(){return this._server}get entities(){return this._entities}}class k{constructor({showFPS:i=!1,targetFPS:o=60},r){this.gameLoop=t=>{this.renderState.secondsPassed=(t-(this.renderState.previousTimeStamp||0))/1e3,this.renderState.previousTimeStamp=t;const e=Math.round(1/this.renderState.secondsPassed);this.settings.showFPS&&this.screen.drawFPS(e),this.screen.draw(this.state.entities,e),window.requestAnimationFrame(this.gameLoop)},this.server=new P(r),this.screen=new S,this.settings={showFPS:i,targetFPS:o},this.state={entities:this.server.entities},this.renderState={secondsPassed:0,previousTimeStamp:null},this.server.server.on("entities",t=>{this.state.entities=t}),T(this.server),window.requestAnimationFrame(this.gameLoop)}}const E={showFPS:!0,targetFPS:60},m=async()=>{const n=window.prompt("Enter a username")||"",i=window.prompt("Enter a password")||"",o=window.prompt("Enter a hex color or color name")||"",r={username:n,color:o,password:i},t=await y.post("http://localhost:8080/register",r);t.data.status==="SUCCESS"?(console.log(t.data),new k(E,t.data.player.id)):(window.alert(t.data.error),m())};m();
