import{TileName as h}from"@core";import{l as g,a as y}from"./vendor.4afd3897.js";const v=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}};v();const d=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],f={[h.DIRT]:{color:"#A0522D"},[h.GRASS]:{color:"#006400"}},u={tile:f[h.DIRT]},x=(n=u)=>{const{tile:i=u.tile}=n,o={};for(let r=0;r<16;r++)for(let e=0;e<24;e++)r%2==0&&e%2!=0||r%2!=0&&e%2==0?o[`${d[r]}${e}`]={tile:i,position:{x:e,y:r}}:o[`${d[r]}${e}`]={tile:f[h.GRASS],position:{x:e,y:r}};return o},p=x({});class S{constructor(){var e;this.height=864,this.width=1296,this.draw=(t,c)=>{this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawFPS(c),Object.keys(p).forEach(l=>{this.renderCell(p[l])}),t.forEach(l=>{this.renderEntity(l)})},this.renderCell=t=>{this.context.fillStyle=t.tile.color,this.context.fillRect(t.position.x*(this.width/24),t.position.y*(this.height/16),54*this.ratio,54*this.ratio)},this.renderEntity=t=>{console.log(t),this.context.fillStyle=t.state.color,this.context.fillRect(t.state.position.x,t.state.position.y,54*this.ratio,54*this.ratio),this.context.font="20px Arial",this.context.fillStyle="white",this.context.textAlign="center",this.context.fillText(t.state.name,t.state.position.x+27,t.state.position.y-5)},this.drawFPS=t=>{this.context.font="25px Arial",this.context.fillStyle="yellow",this.context.fillText("FPS: "+t,10,30)},this.resize=()=>{this.canvas.height=this.height,this.canvas.width=this.width,this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px"},this.generateCanvas=()=>{const t=document.createElement("canvas"),c=t.getContext("2d");if(!c)throw new Error("no context");return t.height=this.height,t.width=this.width,t.style.width=window.innerWidth+"px",t.style.height=window.innerHeight+"px",t.style.backgroundColor="black",{canvas:t,context:c}};const i=document.getElementById("root");if(!i)throw new Error("no root");this.root=i;const{canvas:o,context:r}=this.generateCanvas();this.canvas=o,this.context=r,this.ratio=1,this.canvas.style.border="5px solid var(--gameboy-grey)",this.canvas.style.boxSizing="border-box",(e=this.root)==null||e.append(this.canvas),window.addEventListener("resize",this.resize)}}var s;(function(n){n.RIGHT="right",n.LEFT="left",n.DOWN="down",n.UP="up",n.SPRINT="sprint"})(s||(s={}));const w={68:s.RIGHT,65:s.LEFT,83:s.DOWN,87:s.UP,38:s.UP,37:s.LEFT,39:s.RIGHT,40:s.DOWN,16:s.SPRINT},a={[s.RIGHT]:!1,[s.LEFT]:!1,[s.UP]:!1,[s.DOWN]:!1},T=n=>{document.onkeydown=i=>{const o=w[i.keyCode];if(o)switch(o){case s.RIGHT:a[s.RIGHT]=!0;break;case s.LEFT:a[s.LEFT]=!0;break;case s.DOWN:a[s.DOWN]=!0;break;case s.UP:a[s.UP]=!0;break;case s.SPRINT:a[s.SPRINT]=!0;break}n.server.emit("keyDown",{isPressed:a})},document.onkeyup=i=>{const o=w[i.keyCode];if(o)switch(o){case s.RIGHT:a[s.RIGHT]=!1;break;case s.LEFT:a[s.LEFT]=!1;break;case s.DOWN:a[s.DOWN]=!1;break;case s.UP:a[s.UP]=!1;break;case s.SPRINT:a[s.SPRINT]=!1;break}n.server.emit("keyDown",{isPressed:a})}};class P{constructor(i){this._server=g("http://localhost:8080"),this._entities=[],this._server.on("connect",()=>{console.log("connected"),this._server.emit("join",i)})}get server(){return this._server}get entities(){return this._entities}}class k{constructor({showFPS:i=!1,targetFPS:o=60},r){this.gameLoop=e=>{this.renderState.secondsPassed=(e-(this.renderState.previousTimeStamp||0))/1e3,this.renderState.previousTimeStamp=e;const t=Math.round(1/this.renderState.secondsPassed);this.settings.showFPS&&this.screen.drawFPS(t),this.screen.draw(this.state.entities,t),window.requestAnimationFrame(this.gameLoop)},this.server=new P(r),this.screen=new S,this.settings={showFPS:i,targetFPS:o},this.state={entities:this.server.entities},this.renderState={secondsPassed:0,previousTimeStamp:null},this.server.server.on("entities",e=>{this.state.entities=e}),T(this.server),window.requestAnimationFrame(this.gameLoop)}}const E={showFPS:!0,targetFPS:60},m=async()=>{const n=window.prompt("Enter a username")||"",i=window.prompt("Enter a password")||"",o=window.prompt("Enter a hex color or color name")||"",r={username:n,color:o,password:i},e=await y.post("http://localhost:8080/register",r);e.data.status==="SUCCESS"?(console.log(e.data),new k(E,e.data.player.id)):(window.alert(e.data.error),m())};m();
